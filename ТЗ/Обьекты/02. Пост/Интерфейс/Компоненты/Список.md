# Список взаимосявзей

Ниже — список уже описанных/связанных компонентов и файлов, относящихся к карточке поста и меню действий (для двух сущностей: PostCard + PostActions и сопутствующие). Группированы по смыслу и указаны связи (кто использует кого).

Компоненты (UI)
- PostCard.svelte
  - Включает: Header (аватар, ник, меню), Content (текст, медиа), Footer (панель действий, дата).
  - Использует: PostActions.svelte, MediaGrid/MediaViewer, Toast, Spinner.
  - Подписывается на posts store; диспатчит события (postDeleted, postShared, reportSent).

- PostActions.svelte
  - Меню «три точки» с пунктами: Пожаловаться, Поделиться, Удалить (если владелец).
  - Открывает/взаимодействует с: ReportForm.svelte, ConfirmDialog.svelte.
  - Вызывает API (lib/api/posts.js) и обновляет store (lib/stores/posts.js).
  - Использует utils: clipboard, a11y, clickOutside.

- ReportForm.svelte
  - Модальная форма жалобы (радиокнопки причин, поле комментария, отправить/отмена).
  - При submit эмитит данные в PostActions или вызывает reportPost напрямую.
  - Показывает локальный валидационный state и toasts.

- ConfirmDialog.svelte
  - Универсальный диалог подтверждения (для удаления и других destructive действий).
  - Возвращает confirm/cancel события.

- MediaGrid.svelte / MediaViewer.svelte
  - Отображение прикреплённого медиа (адаптивная сетка, lightbox).
  - Используется в Content внутри PostCard.

- Toast.svelte
  - Глобальные уведомления (aria-live); вызывается из PostActions, ReportForm, ConfirmDialog.

Утилиты и службы
- lib/api/posts.js
  - Функции: getPost, reportPost, getMyReport, deletePost, sharePost, hidePost, like/unlike, repost.
  - Вызывается из PostActions, ReportForm, ConfirmDialog, PostCard (для загрузки поста).

- lib/stores/posts.js
  - Writable store + функции: removePost, hidePostLocal, updatePost, restorePost.
  - Используется PostCard, PostActions, любые списки (Feed.svelte).

- lib/utils/clipboard.js
  - writeText(text) с fallback; используется в PostActions при шаринге.

- lib/utils/a11y.js
  - focusFirst, trapFocus, handleArrowNav; используется в PostActions (меню), ReportForm и ConfirmDialog.

- lib/utils/clickOutside.js
  - Svelte action для закрытия меню/модалей при клике вне; используется в PostActions, ReportForm, ConfirmDialog.

Серверная часть / Endpoints (routes/)
- routes/api/posts/[id].js (GET, PATCH, DELETE)
- routes/api/posts/[id]/reports.js (POST, GET/me, DELETE)
- routes/api/posts/[id]/share.js (POST)
- routes/api/posts/[id]/hide.js (POST)
- routes/api/posts/[id]/likes.js (PUT/DELETE)
- routes/api/posts/[id]/reposts.js (PUT/DELETE)
- routes/api/posts/[id]/comments.js (GET, POST)

Связи — кратко по сценариям
- Жалоба:
  PostCard → PostActions (open) → ReportForm (submit) → lib/api/posts.reportPost → lib/stores.posts.hidePostLocal → Toast → dispatch reportSent

- Поделиться:
  PostCard → PostActions (action) → lib/api/posts.sharePost → lib/utils/clipboard.writeText → Toast → dispatch postShared

- Удаление:
  PostCard → PostActions (open) → ConfirmDialog (confirm) → lib/stores.posts.removePost (optimistic) → lib/api/posts.deletePost → Toast → dispatch postDeleted (или restorePost при ошибке)

- Лайк/репост/комменты:
  Footer(PostCard) → lib/api/posts.like/repost/comment → lib/stores.posts.updatePost → Toast / UI update

## Полный реестр файлов (структура проекта)
src/
  components/
    PostCard.svelte                — карточка поста (Header, Content, Footer)
    PostActions.svelte             — меню «три точки» и логика действий
    ReportForm.svelte              — модальная форма жалобы
    ConfirmDialog.svelte           — универсальный диалог подтверждения
    Toast.svelte                   — глобальные уведомления (aria-live)
    Spinner.svelte                 — индикатор загрузки
    MediaGrid.svelte               — сетка медиа-превью в карточке
    MediaViewer.svelte             — лайтбокс/просмотрщик медиа
    Avatar.svelte                  — компонент аватара (повторно используемый)
    PostHeader.svelte              — часть Header (аватар, имя, handle) — опционально
    PostContent.svelte             — часть Content (текст, linkify, считывание «Читать далее»)
    PostFooter.svelte              — нижняя панель действий (лайк/репост/коммент)
    IconButton.svelte              — универсальная кнопка с иконкой
    Tooltip.svelte                 — всплывающие подсказки (опционально)

  lib/
    api/
      posts.js                     — API функции: getPost, createPost, updatePost, deletePost
      comments.js                  — API для комментариев (GET, POST)
      media.js                     — API для загрузки/метаданных медиа
      auth.js                      — helper для авторизации (fetch wrapper)
    stores/
      posts.js                     — writable store + removePost, hidePostLocal, updatePost, restorePost
      notifications.js             — store/утилиты для Toast (showToast, hideToast)
      session.js                   — user session store (currentUser, isAuthenticated)
    utils/
      clipboard.js                 — writeText с fallback
      a11y.js                      — focusFirst, trapFocus, handleArrowNav
      clickOutside.js              — Svelte action для клика вне
      time.js                      — форматирование дат/времён (relative)
      fetchWrapper.js              — wrapper для fetch с обработкой ошибок/401
      analytics.js                 — обёртка для логирования событий
    types/
      post.d.ts / post.ts          — интерфейсы/типы для Post, Comment, User (опционально)

Дополнительно (опционально)
- src/components/ShareModal.svelte — альтернатива копированию: показать ссылку и соц-кнопки
- src/components/EditPostForm.svelte — редактирование поста для владельца
- src/lib/validators/ — валидация форм
- src/lib/middleware/ratelimit.js — серверный rate-limit helper
- src/lib/cache/ — кеширование для feed
