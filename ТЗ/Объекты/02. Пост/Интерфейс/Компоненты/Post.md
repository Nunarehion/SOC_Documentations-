Карточка поста — описание структуры и поведения

1. Общая структура
- Карточка представляет один пост и состоит из трёх секций: Header, Контент, Нижняя панель действий.
- Карточка кликабельна только в пределах контента; действия выполняются через отдельные кнопки/меню.

2. Header
- Содержит информационную часть и меню действий (иконка «три вертикальные точки») в правом верхнем углу.
- Информационная часть:
  - Аватар: квадрат с округлёнными краями, фиксированный размер (рекомендация 40×40–48×48px).
  - Ник (display name): заметный, жирный шрифт.
  - Юзернейм (handle): под ником, меньшим шрифтом и серым цветом; формат @username.
- Поведение:
  - Клик по аватару или нику — переход на профиль пользователя.
  - Меню действий открывает PostActions (см. отдельный компонент) и не закрывает карточку.

3. Контент
- Текст поста:
  - Поддерживает переносы, URL-детектинг (linkify), упоминания и хэштеги (стилевые выделения, кликабельные).
  - Ограничение длины отображаемого текста с опцией «Показать полностью» (expand/collapse).
- Медиа:
  - Под текстом — сетка/карусель прикреплённых медиа (изображения, видео, audio, файлы).
  - Миниатюры с адаптивным layout (1–4 колонки в зависимости от количества и ширины).
  - Клик по медиa открывает просмотрщик (lightbox/modal) с навигацией.
- Поведение и fallback:
  - Загрузка изображений lazy; placeholder (blur) при загрузке.
  - Если медиа недоступно — показывать заглушку с иконкой ошибки.
  - Максимальный размер превью и аспект‑ratio для видео/изображений единые для консистентности.

4. Нижняя панель действий
- Элементы (слева направо):
  - Кнопка «Комментировать» (иконка + счётчик комментариев).
  - Кнопка «Репост/Поделиться» (иконка + счётчик репостов/ретвитов).
  - Кнопка «Лайк» (иконка сердечка + счётчик лайков).
- Правый край:
  - Дата/время создания поста (короткий формат: "2 ч" / "3 окт" / полный при ховере).
- Поведение:
  - Кнопки интуитивно изменяют состояние (toggled для лайка/репоста).
  - Кнопки показывают состояние loading при выполнении запроса; блокируются для повторных кликов.
  - При нажатии обновлять глобальный store/локально индицировать оптимистично; откат при ошибке.
  - Для незалогиненных пользователей показывать подсказку/модал для входа.

5. Accessibility (a11y)
- Семантика: header — role="group" с aria-labelledby; кнопки — button с aria-pressed/aria-label.
- Клавиатурная навигация: Tab для перехода по элементам; Enter/Space для активации; фокус видим.
- Скринридер: логические описания для кнопок (например, "Поставить лайк, 12 лайков").

6. State и интеграция
- Входные пропсы/данные:
  - postId, author { id, name, handle, avatarUrl }, content { text, media[] }, counts { likes, reposts, comments }, userState { liked, reposted, reported }, createdAt.
- Компоненты-детали: PostActions (меню), MediaViewer (lightbox), CommentsToggle/Composer.
- Store-интеграция: при действиях (лайк, репост, удалить) обновлять глобальный posts store и/или инвалидация маршрута.

7. Визуальные рекомендации
- Карточка: лёгкая тень и закругление, контрастные интерактивные элементы.
- Минимализм: иконки с чёткими состояниями (filled/outline) и анимацией при смене состояния.

8. Короткие UX-правила
- Не перезагружать страницу при действиях — делать AJAX.
- Подтверждение для destructive-операций (удаление).
- Показывать короткие toasts при успешных/ошибочных операциях.
- Кеширование медиа и публикаций для ускорения повторного открытия.

## API‑запросы (синхронизировано с серверным контрактом)

Формат API: завершающий слеш, подресурсы во множественном числе, `snake_case` в ответах. Клиент может маппить в `camelCase` локально.

1) Получить пост
- GET /api/posts/{id}/
- 200 OK: { post: { id, author, content, media, created_at, counts, user_state } }

2) Создать пост
- POST /api/posts/
- Body: { "content": "string", "media_ids": ["uuid", ...] }
- 201 Created: { post: { ... } }

3) Удалить пост (владелец)
- DELETE /api/posts/{id}/
- 204 No Content; ошибки: 403 (не владелец), 404

4) Лайк / снять лайк
- PUT /api/posts/{id}/likes/ — поставить лайк → 200 { liked: true, likes_count: number }
- DELETE /api/posts/{id}/likes/ — снять лайк → 200 { liked: false, likes_count: number }

5) Репост / отмена репоста
- PUT /api/posts/{id}/reposts/ (optional body { "comment"?: "string" }) → 200 { reposted: true, reposts_count: number }
- DELETE /api/posts/{id}/reposts/ → 200 { reposted: false, reposts_count: number }

6) Комментарии
- GET /api/posts/{id}/comments/?limit=20&after={cursor} → 200 { comments:[...], next_cursor:"..." }
- POST /api/posts/{id}/comments/ Body: { "text": "string", "reply_to_comment_id"?: "id" } → 201 { comment: { ... }, comments_count: number }

7) Жалоба (report)
- POST /api/posts/{id}/reports/ Body: { reason, comment? } → 201 { report_id: "uuid", hidden_for_user: true } (409 если уже отправлена)
- GET /api/posts/{id}/reports/me → 200 { reported: boolean, report?: { id, reason, status } }
- DELETE /api/posts/{id}/reports/{report_id}/ → 204

8) Локально скрыть пост
- POST /api/posts/{id}/hide/ → 200 { hidden_for_user: true }

9) Поделиться ссылкой
- POST /api/posts/{id}/share/ Body: { type?: "permalink|short", expires_in?: number } → 200 { url, short_code?, expires_at? }

10) Лента / список постов
- GET /api/posts/?limit=20&after={cursor}&filter={user|following|tag} → 200 { posts:[...], next_cursor }

Рекомендации по поведению API
- Все мутации возвращают актуальные счётчики (likes_count, comments_count, reposts_count).
- Идемпотентность: повторные PUT для лайка/репоста безопасны; повторные жалобы — 409 или вернуть текущий статус.
- Авторизация: 401 если не авторизован; 403 при отсутствии прав.
- Ошибки: структурировать { success:false, code: "string", message: "human" }.
- Лимиты: rate-limit для жалоб и репостов, валидация размеров медиа.
- Audit: логировать report.create, post.delete, post.share с user_id, post_id, ip, user_agent.
