Вот список API-запросов для работы с сущностью **Post** в формате, аналогичном предоставленному описанию авторизации.

## Запросы (API для поста)

Стиль API: DRF с завершающим слешем, подресурсы во множественном числе, идемпотентные методы, `snake_case` в JSON. Пагинация — курсорная (`after`/`next_cursor`).

|   Метод    | Путь                           | Назначение / Описание                                                                         | Параметры / Тело запроса                                                                 | Ответ / Код                                                                                                  |
| :--------: | :----------------------------- | :-------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------- |
|  **POST**  | `/api/posts/`                  | **Создание поста**. Требуется аутентификация.                                                 | JSON: `{"content":"текст", "media_ids":["uuid", ...]}`                          | **201 Created**, JSON: `{ post: { id, author, content, media, created_at, counts, user_state } }`            |
|  **GET**   | `/api/posts/`                  | **Список/лента** в порядке убывания даты. Курсорная пагинация.                                | Query: `limit` (<=50), `after` (cursor), `filter`=`user|following|tag`, `user_id|tag`.  | **200 OK**, JSON: `{ posts:[...], next_cursor:"..." }`                                                     |
|  **GET**   | `/api/posts/{id}/`             | **Получение поста по ID**. Инкрементирует `view_count`.                                       | Path: `{id}`                                                                            | **200 OK**, JSON: `{ post: { ... } }`                                                                        |
| **DELETE** | `/api/posts/{id}/`             | **Удаление (soft delete)**. Только автор.                                                     | Path: `{id}`                                                                            | **204 No Content**                                                                                           |
|  **PUT**   | `/api/posts/{id}/likes/`       | **Поставить лайк** (идемпотентно).                                                            | Path: `{id}`                                                                            | **200 OK**, JSON: `{ liked: true, likes_count: number }`                                                    |
| **DELETE** | `/api/posts/{id}/likes/`       | **Снять лайк**.                                                                               | Path: `{id}`                                                                            | **200 OK**, JSON: `{ liked: false, likes_count: number }`                                                   |
|  **PUT**   | `/api/posts/{id}/reposts/`     | **Сделать репост** (с опциональным комментарием через тело).                                  | Path: `{id}`; JSON: `{ comment?: "string" }`                                          | **200 OK**, JSON: `{ reposted: true, reposts_count: number }`                                               |
| **DELETE** | `/api/posts/{id}/reposts/`     | **Отменить репост**.                                                                          | Path: `{id}`                                                                            | **200 OK**, JSON: `{ reposted: false, reposts_count: number }`                                              |
|  **GET**   | `/api/posts/{id}/comments/`    | **Список комментариев**. Курсорная пагинация.                                                 | Query: `limit` (<=50), `after` (cursor)                                                 | **200 OK**, JSON: `{ comments:[...], next_cursor:"..." }`                                                  |
|  **POST**  | `/api/posts/{id}/comments/`    | **Добавить комментарий**.                                                                     | JSON: `{ "text": "Отличный пост!", "reply_to_comment_id"?: "id" }`              | **201 Created**, JSON: `{ comment: { ... }, comments_count: number }`                                      |
|  **POST**  | `/api/posts/{id}/reports/`     | **Пожаловаться на пост**. Скрывает пост локально для пользователя.                            | JSON: `{ reason: "spam|irrelevant|violence|other", comment?: "string" }`            | **201 Created**, JSON: `{ report_id:"uuid", hidden_for_user:true }`; **409** — если уже есть жалоба       |
|  **GET**   | `/api/posts/{id}/reports/me`   | **Статус жалобы текущего пользователя**.                                                      | —                                                                                       | **200 OK**, JSON: `{ reported: boolean, report?: { id, reason, status } }`                                   |
| **DELETE** | `/api/posts/{id}/reports/{rid}/` | **Отозвать жалобу** (если разрешено политикой).                                              | Path: `{rid}`                                                                           | **204 No Content**                                                                                           |
|  **POST**  | `/api/posts/{id}/hide/`        | **Скрыть пост локально для пользователя** (без жалобы).                                       | —                                                                                       | **200 OK**, JSON: `{ hidden_for_user: true }`                                                                |
|  **POST**  | `/api/posts/{id}/share/`       | **Сгенерировать ссылку** (permalink/short).                                                   | JSON: `{ type?: "permalink|short", expires_in?: number }`                             | **200 OK**, JSON: `{ url:"https://...", short_code?:"...", expires_at?:"ISO" }`                        |
|  **GET**   | `/api/media/{media_id}/`       | **Метаданные медиа**.                                                                         | Path: `{media_id}`                                                                       | **200 OK**, JSON: `{ id, url, type, width, height, duration? }`                                             |

---

## Детали реализации

- **Аутентификация**: Все запросы, кроме `GET /api/posts/` и публичного `GET /api/posts/{id}/`, требуют заголовок `Authorization: Bearer <access_token>`.
- **Удаление**: `DELETE /api/posts/{id}/` — soft delete, в БД `status='deleted'`, ответ **204** без тела.
- **Пагинация**: Курсорная. Сервер возвращает `next_cursor`; клиент передаёт `after`.
- **Счётчики**: Мутации возвращают актуальные `likes_count`, `comments_count`, `reposts_count`.
- **Идемпотентность**: `PUT` для лайка/репоста повторно безопасен; повторные жалобы — **409** или текущий статус.
- **Формат полей**: API — `snake_case`. Клиент может маппить в `camelCase` на уровне адаптеров.
